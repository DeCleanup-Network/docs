# Developer Guide

Welcome to the **DeCleanup Network Developer Guide**! This section provides comprehensive technical documentation for developers interested in contributing to the platform or building integrations with our ecosystem.

## Architecture Overview

DeCleanup Network is built as a **decentralized application (dApp)** with a modern, scalable architecture that combines Web3 technologies with traditional web development best practices.

### **System Components** 🏗️

```mermaid
graph TB
    A[User Interface - React/Next.js] --> B[Backend API - Express.js]
    B --> C[Blockchain Layer - Smart Contracts]
    B --> D[Database - PostgreSQL]
    B --> E[File Storage - IPFS/Filecoin]
    C --> F[EVM Networks - Ethereum/Polygon]
    G[Verification System] --> B
    H[Indexer Service] --> D
    I[External APIs] --> B
```

---

## Tech Stack

### **Frontend** 🎨

**Core Framework**
- **Next.js 15**: Full-stack React framework with App Router
- **React 19**: Component-based UI development
- **TypeScript**: Type-safe development and better DX

**Styling & UI**
- **Tailwind CSS**: Utility-first styling framework
- **shadcn/ui**: Reusable component library
- **Framer Motion**: Smooth animations and interactions
- **React Hook Form**: Optimized form handling

**Web3 Integration**
- **wagmi**: React hooks for Ethereum development
- **viem**: TypeScript interface for Ethereum
- **RainbowKit**: Wallet connection and management
- **SIWE**: Sign-In with Ethereum authentication

**State Management**
- **Zustand**: Lightweight state management
- **TanStack Query**: Server state synchronization
- **Context API**: React's built-in state sharing

### **Backend** ⚙️

**API Layer**
- **Express.js**: Fast, minimalist web framework
- **Prisma**: Next-generation ORM for TypeScript
- **GraphQL**: Efficient data fetching and manipulation
- **REST APIs**: Traditional HTTP endpoints for compatibility

**Database**
- **PostgreSQL**: Robust relational database
- **Redis**: Caching and session management
- **Database Migrations**: Versioned schema changes

**Authentication & Security**
- **JWT**: JSON Web Token authentication
- **SIWE Verification**: Ethereum signature validation
- **Rate Limiting**: API protection and abuse prevention
- **Input Validation**: Request sanitization and validation

### **Blockchain** ⛓️

**Smart Contracts**
- **Solidity**: Smart contract development language
- **Hardhat**: Ethereum development environment
- **OpenZeppelin**: Secure contract templates
- **Foundry**: Fast, portable toolkit for Ethereum

**Deployment Networks**
- **Ethereum Mainnet**: Primary network for governance
- **Polygon**: Low-cost transactions for daily usage
- **Optimism**: Layer 2 scaling solution
- **Arbitrum**: Alternative L2 for redundancy

**Contract Architecture**
```solidity
// Core contract structure
contracts/
├── tokens/
│   ├── DCUToken.sol          // ERC20 utility token
│   ├── ImpactProduct.sol     // ERC721 dynamic NFT
│   └── CleanupNFT.sol        // ERC721 cleanup proof
├── core/
│   ├── CleanupFactory.sol    // Cleanup creation
│   ├── Verification.sol      // Community validation
│   └── Rewards.sol           // Token distribution
└── governance/
    ├── DAO.sol               // Decentralized governance
    └── Treasury.sol          // Fund management
```

### **Infrastructure** 🌐

**File Storage**
- **IPFS**: Decentralized content storage
- **Filecoin**: Long-term data persistence
- **Pinata**: IPFS pinning service
- **Image Optimization**: CDN and compression

**Monitoring & Analytics**
- **Prometheus**: Metrics collection
- **Grafana**: Data visualization
- **Sentry**: Error tracking and performance
- **Google Analytics**: User behavior insights

**DevOps**
- **Docker**: Containerized deployments
- **Kubernetes**: Container orchestration
- **GitHub Actions**: CI/CD pipelines
- **Vercel**: Frontend deployment platform

---

## Smart Contract Details

### **DCU Token Contract** 🪙

**ERC20 Implementation with Extensions**
```solidity
interface IDCUToken {
    function mint(address to, uint256 amount) external;
    function burn(uint256 amount) external;
    function stake(uint256 amount, uint256 duration) external;
    function unstake(uint256 stakeId) external;
    function getVotingPower(address user) external view returns (uint256);
}
```

**Key Features:**
- **Dynamic Supply**: Minted based on verified cleanup impact
- **Staking Rewards**: Lock tokens for yield generation
- **Governance Integration**: Voting power calculation
- **Burn Mechanisms**: Deflationary tokenomics

### **Impact Product NFT** 🎭

**ERC721 with Dynamic Metadata**
```solidity
interface IImpactProduct {
    struct ImpactData {
        uint256 level;
        uint256 dcuEarned;
        uint256 cleanupsCompleted;
        string title;
        uint256 impactScore;
    }
    
    function mint(address to) external returns (uint256);
    function updateImpact(uint256 tokenId, ImpactData memory data) external;
    function getImpactData(uint256 tokenId) external view returns (ImpactData memory);
}
```

**Dynamic Features:**
- **Level Progression**: Visual upgrades based on activity
- **Metadata Updates**: On-chain trait modifications
- **Soulbound Design**: Non-transferable personal achievements
- **Upgrade Triggers**: Automated progression milestones

### **Cleanup Verification System** ✅

**Community-Driven Validation**
```solidity
interface IVerificationSystem {
    struct Submission {
        address submitter;
        string ipfsHash;
        uint256 timestamp;
        VerificationStatus status;
        uint256 yesVotes;
        uint256 noVotes;
    }
    
    function submitCleanup(string memory ipfsHash) external returns (uint256);
    function verifySubmission(uint256 submissionId, bool approve) external;
    function getSubmission(uint256 id) external view returns (Submission memory);
}
```

---

## API Documentation

### **Authentication Endpoints** 🔐

**SIWE Authentication Flow**
```typescript
// Authentication endpoints
POST /auth/nonce              // Get signing nonce
POST /auth/verify             // Verify signature
POST /auth/refresh            // Refresh JWT token
DELETE /auth/logout           // Invalidate session
```

**Example Implementation:**
```typescript
// SIWE verification
const verifySignature = async (signature: string, message: string) => {
  const address = await recoverAddress({ 
    message, 
    signature 
  });
  
  // Verify nonce and create session
  const session = await createUserSession(address);
  return generateJWT(session);
};
```

### **Core API Endpoints** 📡

**User Management**
```typescript
GET    /api/users/profile     // Get user profile
PUT    /api/users/profile     // Update profile
GET    /api/users/stats       // User statistics
GET    /api/users/history     // Cleanup history
```

**Cleanup Submissions**
```typescript
POST   /api/cleanups          // Submit new cleanup
GET    /api/cleanups/:id      // Get cleanup details
PUT    /api/cleanups/:id      // Update submission
DELETE /api/cleanups/:id      // Delete submission
```

**Verification System**
```typescript
GET    /api/verify/pending    // Get pending verifications
POST   /api/verify/:id        // Submit verification vote
GET    /api/verify/stats      // Verifier statistics
```

### **GraphQL Schema** 📊

**Core Types**
```graphql
type User {
  id: ID!
  address: String!
  profile: UserProfile
  impactProduct: ImpactProduct
  cleanups: [Cleanup!]!
  stats: UserStats!
}

type Cleanup {
  id: ID!
  submitter: User!
  ipfsHash: String!
  status: VerificationStatus!
  createdAt: DateTime!
  verifications: [Verification!]!
}

type ImpactProduct {
  tokenId: Int!
  level: Int!
  dcuEarned: Int!
  impactScore: Int!
  metadata: String!
}
```

---

## Development Setup

### **Local Environment** 💻

**Prerequisites**
```bash
# Required software
node >= 18.0.0
npm >= 9.0.0
docker >= 20.0.0
git >= 2.30.0

# Recommended tools
pnpm >= 8.0.0        # Package manager
foundry >= 0.2.0     # Smart contract development
```

**Project Setup**
```bash
# Clone the repository
git clone https://github.com/DeCleanup-Network/dapp.git
cd dapp

# Install dependencies
pnpm install

# Set up environment variables
cp .env.example .env.local
# Edit .env.local with your configuration

# Start local blockchain
npx hardhat node

# Deploy contracts
npx hardhat deploy --network localhost

# Start development server
pnpm dev
```

**Environment Configuration**
```bash
# .env.local
DATABASE_URL="postgresql://user:pass@localhost:5432/decleanup"
NEXTAUTH_SECRET="your-secret-key"
NEXT_PUBLIC_ALCHEMY_KEY="your-alchemy-api-key"
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID="your-walletconnect-id"
IPFS_API_KEY="your-pinata-api-key"
```

### **Testing** 🧪

**Testing Stack**
- **Vitest**: Fast unit testing framework
- **Testing Library**: React component testing
- **Playwright**: End-to-end testing
- **Foundry**: Smart contract testing

**Running Tests**
```bash
# Unit tests
pnpm test

# E2E tests
pnpm test:e2e

# Contract tests
forge test

# Coverage reports
pnpm test:coverage
```

**Test Structure**
```
tests/
├── unit/              # Component and utility tests
├── integration/       # API and service tests
├── e2e/              # Full application tests
└── contracts/        # Smart contract tests
```

---

## Contributing Guidelines

### **Development Workflow** 🔄

**Branch Strategy**
```
main                  # Production-ready code
develop               # Integration branch
feature/xyz           # Feature development
bugfix/xyz            # Bug fixes
hotfix/xyz            # Critical production fixes
```

**Commit Standards**
```
feat: add new cleanup submission flow
fix: resolve verification voting bug
docs: update API documentation
test: add unit tests for rewards system
refactor: optimize database queries
```

### **Code Standards** 📝

**TypeScript Guidelines**
- Use strict TypeScript configuration
- Prefer type inference over explicit types
- Use interfaces for object shapes
- Implement proper error boundaries

**React Best Practices**
- Use functional components with hooks
- Implement proper component composition
- Follow accessibility guidelines (WCAG 2.1)
- Optimize for performance with React.memo

**Smart Contract Standards**
- Follow OpenZeppelin patterns
- Implement comprehensive testing
- Use natspec documentation
- Optimize for gas efficiency

### **Pull Request Process** 📋

**PR Requirements**
1. **Tests**: All new code must include tests
2. **Documentation**: Update relevant documentation
3. **Code Review**: Minimum 2 reviewer approvals
4. **CI/CD**: All automated checks must pass
5. **Deployment**: Staging deployment verification

**Review Checklist**
- [ ] Code follows style guidelines
- [ ] Tests cover new functionality
- [ ] Documentation is updated
- [ ] Security considerations addressed
- [ ] Performance impact assessed

---

## Deployment

### **Production Environment** 🚀

**Infrastructure**
- **Frontend**: Vercel with CDN
- **Backend**: AWS ECS with auto-scaling
- **Database**: AWS RDS PostgreSQL
- **Blockchain**: Ethereum + Polygon mainnet

**Deployment Pipeline**
```yaml
# GitHub Actions workflow
name: Deploy Production
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy contracts
        run: forge script Deploy --rpc-url $RPC_URL
      - name: Deploy backend
        run: docker build && docker push
      - name: Deploy frontend
        uses: vercel/action@v1
```

**Environment Management**
- **Development**: Local + testnets
- **Staging**: Production-like with test data
- **Production**: Mainnet with real users

<nav className='flex items-center justify-end space-x-2'>
  <ArrowRight />
  <Link href='/roadmap'>next: Roadmap</Link>
</nav> 